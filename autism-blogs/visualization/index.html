<!DOCTYPE html>

<html style = "height: 100%; width: 100%">
    <head>
        <meta charset="utf-8">
        <title> Similarity Analysis </title>
    </head>
    <body onload = "adjustCheckboxes()" onresize = "adjustCheckboxes()" style = "height: 100%; width: 100%">
        <script src="d3.js"></script>
        <script src="jquery.js"></script>
        <script src="cosineData.js"></script>
        <script src="yearlydata.js"></script>
        <script src="totalposts.js"></script>

        <div class="filters" style="float: left; width: 40%; height: 100%; overflow-y: scroll">
            <div id = 'column1' style = "float: left; width: 50%; height: 100%; overflow-y: scroll; overflow-x: scroll"> </div>
            <div id = 'column2' style = "float: left; width: 50%; height: 100%"> </div>
        </div>
        <div id = "simScoresTitle" style = "height: 8.5%; width: 30%; position: absolute; top: 40%; left: 20%"> </div> 
        <div id = "simScores" style = "height: 48%; width: 30%; position: absolute; top: 50%; left: 20%; overflow-y: scroll; overflow-x: hidden"> </div>
        <div id = "selected" style = "position: absolute; top: 1%; left: 35%"> </div>
        <div id = "dropdown" style = "position: absolute; top: 6%; left: 43%">
            Year: 
            <select id = "year" onchange = "changeYear()">
                <option class = 'year' selected> All </option>
                <option class = 'year'> 2017 </option>
                <option class = 'year'> 2016 </option>
                <option class = 'year'> 2015 </option>
                <option class = 'year'> 2014 </option>
                <option class = 'year'> 2013 </option>
                <option class = 'year'> 2012 </option>
                <option class = 'year'> 2011 </option>
                <option class = 'year'> 2010 </option>
                <option class = 'year'> 2009 </option>
                <option class = 'year'> 2008 </option>
                <option class = 'year'> 2007 </option>
                <option class = 'year'> 2006 </option>
                <option class = 'year'> 2005 </option>
                <option class = 'year'> 2004 </option>
                <option class = 'year'> 2003 </option>
            </select>
        </div>
        <table style = "border-collapse: collapse; position: absolute; top: 8.5%; left: 45% ">
            <thead>
                <tr>
                    <td style = "padding-bottom: 10px"></td>
                    <td style = "padding-bottom: 10px"></td>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style = "padding: 0px; border-color: #000000; border-style: solid; border-width: thin">
                        <button id = "minus" onclick = "decrementyear()" style = "border-style: solid; color: #000000; background-color: #BCBCBC; border-color: #000000; border-width: thin; width: 100%" disabled> - </button>
                    </td> 
                    <td style = "padding: 0px; border-color: #000000; border-style: solid; border-width: thin">
                        <button id = "plus" onclick = "incrementyear()" style = "border-style: solid; color: #000000; background-color: #BCBCBC; border-color: #000000; border-width: thin; width: 100%" disabled> + </button>
                    </td>
                </tr>  
            </tbody>
        </table>


        <script>

            // GLOBAL VARIABLES

            // Links for all blogs
            var blogs = ["ablogonthespectrum.blogspot.com", "adiaryofamom.com", "adventuresinautism.blogspot.co.uk", "alyric.blogspot.com", "aspergersquare8.blogspot.com",
                "autism-vicky.blogspot.com", "autism.typepad.com", "autismandoughtisms.wordpress.com", "autismblogsdirectory.blogspot.com", "autismcrisis.blogspot.com:", // id = 10
                "autismgadfly.blogspot.com", "autisminnb.blogspot.com", "autismjabberwocky.blogspot.com", "autismnaturalvariation.blogspot.com", "autismschmatism.blogspot.com",
                "autismsedges.blogspot.com", "autismsucksrocks.blogspot.com", "bloom-parentingkidswithdisabilities.blogspot.com", "carrielink.blogspot.com", "chavisory.wordpress.com", // id = 20
                "club166.blogspot.com", "confessionsofanaspergersmom.blogspot.com", "daysixtyseven.blogspot.com", "donnathomson.com", "elvis-sightings.blogspot.com:",
                "embracingchaos.stephanieallencrist.com", "esteeklar.com", "extraordinary-ordinary.net", "fullspectrummama.blogspot.com", "hoopdeedoo.blogspot.com", // id = 30
                "idoinautismland.com", "injectingsense.blogspot.com", "jennyalice.com", "joeyandymom.blogspot.com", "juststimming.wordpress.com",
                "leftbrainrightbrain.co.uk", "letitbeautism.blogspot.com", "lizditz.typepad.com", "lovethatmax.com", "maternalinstincts.wordpress.com", // id = 40
                "mfamama.typepad.com:my-blog", "momnos.blogspot.com", "motherofshrek.blogspot.com", "noahsdad.com", "onedadsopinion.blogspot.com",
                "questioning-answers.blogspot.com", "qw88nb88.wordpress.com", "rebekahscot.wordpress.com", "rhemashope.wordpress.com", "roostercalls.blogspot.com", // id = 50
                "specialed.wordpress.com", "spectrumliving.blogspot.com", "squashedmom.com", "squidalicious.com", "stimcity.org",
                "stimeyland.com", "susanetlinger.typepad.com", "susansenator.com:blog", "teenautism.com", "theadventuresofboywonder.blogspot.com", // id = 60
                "thefamilyvoyage.blogspot.com", "therocchronicles.wordpress.com", "thismom.blogs.com", "tinygracenotes.blogspot.com", "trydefyinggravity.wordpress.com/autism",
                "unstrangemind.com"];
            // Selected blogs (as of Dec 2016)
            var blogids = [1, 2, 3, 4, 7,
                8, 12, 13, 14, 15,
                16, 19, 21, 22, 23,
                25, 26, 27, 29, 30,
                32, 33, 34, 36, 37,
                40, 42, 43, 45, 48,
                49, 50, 51, 52, 53,
                54, 55, 56, 57, 58,
                59, 60, 61, 62, 63,
                65];
            // The blog in the center of the visualization
            var primaryblog = null;
            // The blog being compared with the primary blog
            var secondaryblog = null;
            // The year being viewed
            var year = " All ";
            // Data for the year being viewed
            var singleyeardata = null;
            
            // INITIAL SETUP

            d3.select(".filters").style("display", "inline-block");
            //Width and Height of the visualization's frame
            var width = 650,
                    height = 700;
            // https://stackoverflow.com/questions/18822756/mouse-events-on-overlapping-svg-elements
            // Make multiple SVG Containers on top of each other ("layers" for the visualization)
            var svgContainerA = d3.select("body").append("svg")
                    .attr("width", "60%")
                    .attr("height", "100%")
                    .style("position", "absolute")
                    .style("top", "0%")
                    .style("left", "40%")
                    .attr("pointer-events", "none")
                    .attr("viewBox", "-150, -20, 800, 610");
            var svgContainerB = d3.select("body").append("svg")
                    .attr("width", "60%")
                    .attr("height", "100%")
                    .style("position", "absolute")
                    .style("top", "0%")
                    .style("left", "40%")
                    .attr("pointer-events", "none")
                    .attr("viewBox", "-150, -20, 800, 610");
            var svgContainerC = d3.select("body").append("svg")
                    .attr("width", "60%")
                    .attr("height", "100%")
                    .style("position", "absolute")
                    .style("top", "0%")
                    .style("left", "40%")
                    .attr("pointer-events", "none")
                    .attr("viewBox", "-150, -20, 800, 610");
            var height = 610;
            var width = 625;
            var i = 0,
                    cx = width / 2,
                    cy = height / 2,
                    bigradius = 300;
            var slice = 2 * Math.PI / blogids.length;
            var phase = 0;
            var cen = 128;
            var w = 127;
            // set up scale circles around middle
            var strokeOpacity = 0.0;
            for (i = 1; i * (bigradius / 8.0) <= bigradius; i++) {
                strokeOpacity = 0.2; // calculate opacity based on distance
                strokeOpacity -= (((i % 2) !== 0) ? 0.05 : 0.0);
                strokeOpacity -= (((i % 4) !== 0) ? 0.10 : 0.0);
                svgContainerA.append("circle")
                        .attr("cx", cx)
                        .attr("cy", cy)
                        .attr("class", "scaleCircle")
                        .style("stroke", "black")
                        .style("stroke-opacity", strokeOpacity)
                        .style("fill-opacity", 0)
                        .attr("r", i * (bigradius / 8.0));
            }
            // Set up various dots that will be in the visualization
            for (var l = 0; l < blogids.length; l += 1) {
                var id = blogids[l]; // id encodes the index in the list of blogs (or rather, the index + 1)
                var index = blogids.indexOf(parseInt(id));
                var angle = slice * l;
                var newX = (cx + bigradius * Math.cos(angle));
                var newY = (cy + bigradius * Math.sin(angle));
                var name = blogs[id - 1];
                blogposts = 0;
                for (var j = 0; j < totalposts.length; j += 1) {
                    if (parseInt(totalposts[j][0]) === parseInt(id)) {
                        blogposts = totalposts[j][1];
                    }
                }
                var red = Math.sin(slice * l + 2 + phase) * w + cen;
                var green = Math.sin(slice * l + 0 + phase) * w + cen;
                var blue = Math.sin(slice * l + 4 + phase) * w + cen;
                // Set up dots to show paths in the future
                for (j = parseInt($(".year")[1].value); j >= (parseInt($(".year")[$(".year").length - 1].value)); j -= 1) {
                    for (k = 0; k < yearlydata.length; k += 1) {
                        if (yearlydata[k][0] === id) {
                            if (yearlydata[k][1] === j) {
                                var dotid = id + "" + j;
                                var circle = svgContainerA.append("circle")
                                        .attr("id", dotid)
                                        .attr("cx", newX)
                                        .attr("cy", newY)
                                        .attr("class", "pathDot")
                                        .style("fill", "#A0A0A0")
                                        .attr("r", findRadius(blogids.indexOf(parseInt(id)), j))
                                        .attr("fill-opacity", 0)
                                        .attr("pointer-events", "auto");
                            }
                        }
                    }
                }
                // Second set of dots so that prominent ones can be shown as such later on
                for (j = parseInt($(".year")[1].value); j >= (parseInt($(".year")[$(".year").length - 1].value)); j -= 1) {
                    for (k = 0; k < yearlydata.length; k += 1) {
                        if (yearlydata[k][0] === id) {
                            if (yearlydata[k][1] === j) {
                                var dotid = id + "" + j;
                                var circle = svgContainerB.append("circle")
                                        .attr("id", dotid + "B")
                                        .attr("cx", newX)
                                        .attr("cy", newY)
                                        .attr("class", "pathDotB")
                                        .style("fill", "#A0A0A0")
                                        .attr("r", findRadius(blogids.indexOf(parseInt(id)), j))
                                        .attr("fill-opacity", 0)
                                        .attr("pointer-events", "auto");
                            }
                        }
                    }
                }
                // Actual dot for blog
                var circle = svgContainerC.append("circle")
                        .attr("id", id)
                        .attr("cx", newX)
                        .attr("cy", newY)
                        .attr("x", newX)
                        .attr("y", newY)
                        .attr("class", "blogCircle")
                        .style("fill", RGB2Color(red, green, blue))
                        .attr("r", findRadius(index, year))
                        .attr("fill-opacity", 1)
                        .attr("pointer-events", "auto");
                // Colors for legend
                if (parseInt(id) === 59) {
                    var r = red;
                    var g = green;
                    var b = blue;
                }
            }
            // Legend creation
            var legendBox = svgContainerA.append("rect")
                .attr("width", "13%")
                .attr("height", "20%")
                .attr("x", "-130")
                .attr("y", "60")
                .style("outline-style", "solid")
                .style("outline-color", "#000000")
                .style("fill", "#FFFFFF");
            
            var small = svgContainerA.append("circle")
                    .attr("id", "small")
                    .attr("cx", -107)
                    .attr("cy", 90)
                    .style("fill", RGB2Color(r, g, b))
                    .attr("r", 15 - 3 * (Math.log10(1 / 0.001)))
                    .attr("fill-opacity", 1);

            var smalllabel = svgContainerA.append("text")
                    .attr("id", "smalllabel")
                    .html("0.001")
                    .attr("x", -87)
                    .attr("y", 95);

            var medium = svgContainerA.append("circle")
                    .attr("id", "medium")
                    .attr("cx", -107)
                    .attr("cy", 120)
                    .style("fill", RGB2Color(r, g, b))
                    .attr("r", 15 - 3 * (Math.log10(1 / 0.01)))
                    .attr("fill-opacity", 1);

            var mediumlabel = svgContainerA.append("text")
                    .attr("id", "mediumlabel")
                    .html("0.01")
                    .attr("x", -87)
                    .attr("y", 125);

            var large = svgContainerA.append("circle")
                    .attr("id", "large")
                    .attr("cx", -107)
                    .attr("cy", 150)
                    .style("fill", RGB2Color(r, g, b))
                    .attr("r", 15 - 3 * (Math.log10(1 / 0.1)))
                    .attr("fill-opacity", 1);

            var largelabel = svgContainerA.append("text")
                    .attr("id", "largelabel")
                    .html("0.1")
                    .attr("x", -87)
                    .attr("y", 155);
            //Set up hover div to display blog name
                var div = d3.select("body")
                        .append("div")
                        .attr("class", "tooltip")
                        .style("display", "none")
                        .style("position", "absolute")
                        .style("top", "0.5%")
                        .style("right", "1%");
            // Event Listeners
            var blogCircles = document.getElementsByClassName("blogCircle");
            for (var i = 0; i < blogCircles.length; i++) {
                blogCircles[i].addEventListener("mouseover", mouseoverA);
                blogCircles[i].addEventListener("mouseout", mouseoutA);
                blogCircles[i].addEventListener("click", click);
            }
            var pathDots = document.getElementsByClassName("pathDotB");
            for (var i = 0; i < pathDots.length; i++) {
                pathDots[i].addEventListener("mouseover", mouseoverB);
                pathDots[i].addEventListener("mouseout", mouseoutB);
            }

            // HELPER METHODS AND EVENT HANDLERS

            // Get the appropriate radius for a given element
            function findRadius(blogindex, yearb) {
                var topicScores = sumTopicScores(yearb);
                var topicScore = topicScores[parseInt(blogindex)];
                if (topicScore > 1) {
                    topicScore = 1;
                }
                return 15 - 3 * (Math.log10(1 / topicScore));
            }

            // Find the average topic scores for blogs across topics
            function sumTopicScores(yearb) {
                var topics = getCheckedBoxes("filter_button");
                var sums = [];
                var sum = 0;
                if (yearb === " All ") {
                    for (h = 0; h < blogids.length; h += 1) {
                        for (m = 0; m < topics.length; m += 1) {
                            var topic = parseInt(topics[m]);
                            sum = parseFloat(sum) + parseFloat(data[parseInt(h)][topic - 1]);
                        }
                        sums[h] = sum;
                        sum = 0;
                    }
                }
                else {
                    for (h = 0; h < blogids.length; h += 1) {
                        for (m = 0; m < topics.length; m += 1) {
                            var topic = parseInt(topics[m]);
                            sum = parseFloat(sum) + parseFloat(yearlydata[parseInt(h)][topic]);
                        }
                        sums[h] = sum;
                        sum = 0;
                    }
                }
                return sums;
            }
            
            // Adjust the layout of the checkboxes based on the window size
            function adjustCheckboxes() {
                // Dealing with page length
                if ($("body").width() >= 1200) {
                    var margin = Math.round((700 - $("body").height()) / 20);
                    if (margin > 15) {
                        margin = 15;
                    }
                    else if (margin < 0) {
                        margin = 0;
                    }
                    var n1 = 36 + margin;
                    var n2 = 15 - margin;
                    var checkboxes1 = "";
                    var checkboxes2 = "";
                    for (i = 0; i < n1; i += 1) {
                        checkboxes1 += "<input class='filter_button' value = '" + i + "' type='checkbox' /><br>";
                    }
                    for (i = 0; i < n2; i += 1) {
                        checkboxes2 += "<input class='filter_button' value = '" + (i + n1) + "' type='checkbox' /><br>";
                    }
                }
                else {
                    checkboxes1 = "";
                    checkboxes2 = "";
                    for (i = 0; i < 51; i += 1) {
                        checkboxes1 += "<input class='filter_button' value = '" + i + "' type='checkbox' /><br>";
                    }
                }
                $("#column1").empty();
                $("#column2").empty();
                $("#column1").html(checkboxes1);
                $("#column2").html(checkboxes2);
                var checkboxes = document.getElementsByClassName("filter_button");
                // Assign the topic names to the check boxes
                checkboxes[0].outerHTML = "<input class=\"filter_button\" id= '0' value= '0' type=\"checkbox\" onchange = 'updatetopics(false)'> All Topics </input>";
                for (var i = 1; i < checkboxes.length; i++) {
                    checkboxes[i].outerHTML = "<input class=\"filter_button\" id=\"" + (i) + "\" value=" + (i) + " type=\"checkbox\" onchange = 'updatetopics(false)'>" + topics[parseInt(checkboxes[i - 1].value)] + "</input>";
                }
                // By default, we want to start with "All Topics" selected
                checkboxes[0].checked = true;
            }

            //Display blog name/number of posts in div when "blog circle" is hovered over
            function mouseoverA() {
                if (year === " All ") {
                    var blogid = $(this).attr("id");
                    var totalblogposts = null;
                    for (var i = 0; i < totalposts.length; i += 1) {
                        if (parseInt(totalposts[i][0]) === parseInt(blogid)) {
                            totalblogposts = totalposts[i][1];
                        }
                    }
                    div.html(blogs[$(this).attr("id") - 1] + "<br /> Total Posts: " + totalblogposts);
                    div.style("display", "block");
                    $(this).attr("r", 15);
                }
                else {
                    var blogid = $(this).attr("id");
                    var yearblogposts = null;
                    for (var i = 0; i < yearlydata.length; i += 1) {
                        if (parseInt(yearlydata[i][1]) === parseInt(year)) {
                            if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                yearblogposts = yearlydata[i][52];
                            }
                        }
                    }
                    div.html(blogs[$(this).attr("id") - 1] + "<br /> Posts in " + year + ": " + yearblogposts);
                    div.style("display", "block");
                    $(this).attr("r", 15);
                }
                if (secondaryblog !== null) {
                    if (parseInt($(this).attr("id")) === parseInt(secondaryblog.attr("id"))) {
                        $(this)
                            .attr("stroke", "#000000")
                            .attr("stroke-opacity", 1)
                            .attr("stroke-width", 3);
                    }
                }
            }
            //Hide information from div when the mouse is moved away from the "blog circle"
            function mouseoutA() {
                div.style("display", "none");
                var id = $(this).attr("id");
                var index = blogids.indexOf(parseInt(id));
                $(this).attr("r", findRadius(index, year));
                if (secondaryblog !== null) {
                    if (parseInt($(this).attr("id")) === parseInt(secondaryblog.attr("id"))) {
                        $(this)
                            .attr("stroke", "#000000")
                            .attr("stroke-opacity", 1)
                            .attr("stroke-width", 3);
                    }
                }
            }
            // Display relevant information when one of the "path dots" is hovered over
            function mouseoverB() {
                var dotid = $(this).attr("id");
                var blogyear = "";
                var blogid = "";
                if (parseInt(dotid.length) === parseInt(6)) {
                    blogid = dotid[0];
                    for (j = 1; j < 5; j += 1) {
                        blogyear += dotid[j];
                    }
                } else {
                    for (j = 0; j < 2; j += 1) {
                        blogid += dotid[j];
                    }
                    for (j = 2; j < 6; j += 1) {
                        blogyear += dotid[j];
                    }
                }
                var yearposts = null;
                for (var i = 0; i < yearlydata.length; i += 1) {
                    if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                        if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                            yearposts = yearlydata[i][52];
                        }
                    }
                }
                div.html("Blog: " + blogs[blogid - 1] + " <br /> Year: " + blogyear + " <br /> Number of Posts: " + yearposts);
                div.style("display", "block");
                $(this)
                    .attr("stroke", "#000000")
                    .attr("stroke-width", 3)
                    .attr("stroke-opacity", 1);
                var blogCircles = document.getElementsByClassName("blogCircle");
                for (var i = 0; i < blogCircles.length; i++) {
                    var secondaryid = $(blogCircles[i]).attr("id");
                    if (parseInt(secondaryid) === parseInt(blogid)) {
                        $(blogCircles[i])
                            .attr("stroke", "#000000")
                            .attr("stroke-width", 3)
                            .attr("stroke-opacity", 1);
                    }
                }
            }
            // Hide information from the div when the mouse is moved away from the "path dot"
            function mouseoutB() {
                var dotid = $(this).attr("id");
                var blogid = "";
                if (parseInt(dotid.length) === parseInt(6)) {
                    blogid = dotid[0];
                } else {
                    for (j = 0; j < 2; j += 1) {
                        blogid += dotid[j];
                    }
                }
                div.style("display", "none");
                if (secondaryblog !== null) {
                    if (parseInt(blogid) !== parseInt(secondaryblog.attr("id"))) {
                        $(this)
                            .attr("stroke", "none");
                    }
                }
                else {
                    $(this)
                        .attr("stroke", "none");
                }
                var blogCircles = document.getElementsByClassName("blogCircle");
                for (var i = 0; i < blogCircles.length; i++) {
                    var otherid = $(blogCircles[i]).attr("id");
                    if (parseInt(otherid) === parseInt(blogid)) {
                        if (secondaryblog !== null) {
                            if (parseInt(otherid) !== parseInt(secondaryblog.attr("id"))) {
                                $(blogCircles[i])
                                    .attr("stroke", "none");
                            }
                        }
                        else {
                            $(blogCircles[i])
                                .attr("stroke", "none");
                        }
                    }
                }
            }
            //Returns a list of checked box values
            function getCheckedBoxes(chkboxName) {
                var checkboxes = document.getElementsByClassName(chkboxName);
                var checkboxesChecked = [];
                // loop over them all, skipping the All Topics one
                for (var i = 1; i < checkboxes.length; i++) {
                    // And stick the checked ones onto an array...
                    if (checkboxes[i].checked) {
                        var val = d3.select(checkboxes[i]).attr("value");
                        checkboxesChecked.push(parseInt(val));
                    }
                }
                // make All Topics override other selections.
                if (checkboxesChecked.length === 0) {
                    checkboxesChecked = [];
                    for (var i = 1; i <= 50; i++) {
                        checkboxesChecked.push(i);
                    }
                } else
                {
                    // epsb: since the checkboxes includes "All Topics" at the beginning, we need to decrement to get the proper topic number
                    for (var i = 0; i < checkboxesChecked.length; i++) {
                        checkboxesChecked[i] -= 1;
                    }
                }
                // Return the array if it is non-empty, or null
                return checkboxesChecked.length > 0 ? checkboxesChecked : null;
            }
            // Converts a color in rgb to a color in hex
            function RGB2Color(r, g, b)
            {
                return '#' + byte2Hex(r) + byte2Hex(g) + byte2Hex(b);
            }
            function byte2Hex(n)
            {
                var nybHexString = "0123456789ABCDEF";
                return String(nybHexString.substr((n >> 4) & 0x0F, 1)) + nybHexString.substr(n & 0x0F, 1);
            }
            //Gives cosine similarity of two equal length vectors A and B for selected topics
            function cosineSim(vectorA, vectorB, selectedTopics) {
                var numerator = 0;
                var denomA = 0;
                var denomB = 0;
                if (selectedTopics.length === 1) {
                    var difference = Math.abs(vectorA[selectedTopics[0]] - vectorB[selectedTopics[0]]);
                    var ave = vectorA[selectedTopics[0]] / 2.0 + vectorB[selectedTopics[0]] / 2.0;
                    var pd = difference / ave;
                    if (pd > 1) {
                        pd = 1;
                    }
                    return 1 - pd;
                } else {
                    for (var i = 0; i < vectorA.length; i++) {
                        if (selectedTopics.indexOf(i) !== -1) {
                            numerator = numerator + (vectorA[i] * vectorB[i]);
                            denomA = denomA + (vectorA[i] * vectorA[i]);
                            denomB = denomB + (vectorB[i] * vectorB[i]);
                        }
                    }
                    var denominator = Math.sqrt(denomA) * Math.sqrt(denomB);
                    return numerator / (denominator);
                }
            }
            // Displays to the user how similar the center blog and the selected blog are with respect to the defined topic(s) (along with the shortened link for the selected blog)
            function displaySimScores(simScores, link, rgb) {
                var box = $("#simScores");
                $("#simScoresTitle").append("<p> <div style = 'text-align: center; font-size: 18pt; font-weight: bold'> Similarity Scores </div> <div style = 'text-align: center'>" + link + " </div> </p>");
                var content = "<table> <thead style = 'font-weight: bold; text-decoration: underline'> <tr> <td> Topic </td> <td> Score </td> </tr> </thead> <tbody> ";
                for (i in simScores) {
                    content = content + "<tr> <td class = 'topicOrScore'> " + simScores[i][1] + " </td> <td> " + +simScores[i][0].toFixed(12) + " </td> </tr>";
                }
                content = content + "</tbody> </table>";
                box.append(content);
                $(".topicOrScore").css("padding-right", "20px");
                box.css("border", "solid");
                box.css("border-color", rgb);
            }

            // METHODS THAT CALL FOR A CHANGE IN DATA DISPLAY  

            // Makes things happen when "blog circles" are clicked on
            function click() {
                // Primary blog de-selected
                if (parseInt($(this).attr("cx")) === parseInt(width / 2) && parseInt($(this).attr("cy")) === parseInt(height / 2)) {
                    primaryblog = null;
                    secondaryblog = null;
                    updateDisplay(true, true, true, true, true);
                    if (year !== " All ") {
                        var all = "Year: <select id = 'year' onchange = 'changeYear()'> <option class = 'year'> All </option> <option class = 'year'> 2017 </option> <option class = 'year'> 2016 </option> <option class = 'year'> 2015 </option> <option class = 'year'> 2014 </option> <option class = 'year'> 2013 </option> <option class = 'year'> 2012 </option> <option class = 'year'> 2011 </option> <option class = 'year'> 2010 </option> <option class = 'year'> 2009 </option> <option class = 'year'> 2008 </option> <option class = 'year'> 2007 </option> <option class = 'year'> 2006 </option> <option class = 'year'> 2005 </option> <option class = 'year'> 2004 </option> <option class = 'year'> 2003 </option> </select>";
                        $("#dropdown").html(all);
                        $("#year").val(year);
                    } else {
                        var all = "Year: <select id = 'year' onchange = 'changeYear()'> <option class = 'year' selected> All </option> <option class = 'year'> 2017 </option> <option class = 'year'> 2016 </option> <option class = 'year'> 2015 </option> <option class = 'year'> 2014 </option> <option class = 'year'> 2013 </option> <option class = 'year'> 2012 </option> <option class = 'year'> 2011 </option> <option class = 'year'> 2010 </option> <option class = 'year'> 2009 </option> <option class = 'year'> 2008 </option> <option class = 'year'> 2007 </option> <option class = 'year'> 2006 </option> <option class = 'year'> 2005 </option> <option class = 'year'> 2004 </option> <option class = 'year'> 2003 </option> </select>";
                        $("#dropdown").html(all);
                    }
                    var disabledminus = true;
                    var disabledplus = true;
                    if (year < 2017) {
                        disabledplus = false;
                    }
                    if (year > 2003) {
                        disabledminus = false;
                    }
                    $("#minus").attr("disabled", disabledminus);
                    if (disabledminus === true) {
                        $("#minus").css("background-color", "#BCBCBC");
                        $("#minus").css("color", "#000000");
                    } else {
                        $("#minus").css("background-color", "#FFFFFF");
                    }
                    $("#plus").attr("disabled", disabledplus);
                    if (disabledplus === true) {
                        $("#plus").css("background-color", "#BCBCBC");
                        $("#plus").css("color", "#000000");
                    } else {
                        $("#plus").css("background-color", "#FFFFFF");
                    }
                }
                // Secondary blog selected
                else if (primaryblog) {
                    secondaryblog = $(this);
                    updateDisplay(true, true, true, true, false);
                }
                // New primary blog selected
                else {
                    primaryblog = $(this);
                    updateDisplay(true, true, true, true, true);
                    if (year !== " All ") {
                        var restricted = "Year: <select id = 'year' onchange = 'changeYear()'> <option class = 'year'> All </option> ";
                    } else {
                        var restricted = "Year: <select id = 'year' onchange = 'changeYear()'> <option class = 'year' selected> All </option> ";
                    }
                    var years = document.getElementsByClassName("year");
                    var primaryid = primaryblog.attr("id");
                    for (i = 1; i < years.length; i += 1) {
                        // for-loop that determines if there is data for that blog and year
                        for (j = 0; j < yearlydata.length; j += 1) {
                            if (parseInt(yearlydata[j][0]) === parseInt(primaryid)) {
                                if (parseInt(yearlydata[j][1]) === parseInt(years[i].innerText)) {
                                    restricted += "<option class = 'year'> " + parseInt(years[i].innerText) + " </option> ";
                                }
                            }
                        }
                    }
                    restricted += " </select>";
                    $("#dropdown").html(restricted);
                    if (year !== " All ") {
                        $("#year").val(year);
                    }
                    var disabledminus = true;
                    var disabledplus = true;
                    for (j = 0; j < yearlydata.length; j += 1) {
                        if (parseInt(yearlydata[j][0]) === parseInt(primaryid)) {
                            if (parseInt(yearlydata[j][1]) === year - 1) {
                                disabledminus = false;
                            }
                            if (parseInt(yearlydata[j][1]) === year + 1) {
                                disabledplus = false;
                            }
                        }
                    }
                    $("#minus").attr("disabled", disabledminus);
                    if (disabledminus === true) {
                        $("#minus").css("background-color", "#BCBCBC");
                        $("#minus").css("color", "#000000");
                    } else {
                        $("#minus").css("background-color", "#FFFFFF");
                    }
                    $("#plus").attr("disabled", disabledplus);
                    if (disabledplus === true) {
                        $("#plus").css("background-color", "#BCBCBC");
                        $("#plus").css("color", "#000000");
                    } else {
                        $("#plus").css("background-color", "#FFFFFF");
                    }
                }
            }
            // Reacts to a checkbox being either checked or unchecked
            function updatetopics(all) {
                var checkboxes = document.getElementsByClassName("filter_button");
                var topicchecked = false;
                for (var i = 1; i < checkboxes.length; i++) {
                    if (checkboxes[i].checked) {
                        topicchecked = true;
                    }
                }
                if (topicchecked) {
                    if (!all) {
                        $(".filter_button")[0].checked = false;
                    }
                }
                if (all) {
                    for (var i = 1; i < checkboxes.length; i++) {
                        checkboxes[i].checked = false;
                    }
                    $(".filter_button")[0].checked = true;
                }
                if (getCheckedBoxes("filter_button").length === 50) {
                    $(".filter_button")[0].checked = true;
                }
                updateDisplay(true, true, true, true, false);
            }
            // Reacts to a change in the year being displayed via the drop-down menu
            function changeYear() {
                year = $("#year :selected").text();
                if (year === " All ") {
                    singleyeardata = null;
                } else {
                    year = Number.parseInt(year);
                    singleyeardata = [];
                    for (i = 0; i < yearlydata.length; i += 1) {
                        if (yearlydata[i][1] === year) {
                            var temparray = [];
                            temparray[0] = yearlydata[i][0];
                            for (var k = 2; k < 53; k += 1) {
                                temparray[k - 1] = yearlydata[i][k];
                            }
                            singleyeardata[parseInt(yearlydata[i][0])] = temparray;
                        }
                    }
                }
                if (year === " All ") {
                    $("#minus").attr("disabled", true);
                    $("#minus").css("background-color", "#BCBCBC");
                    $("#minus").css("color", "#000000");
                    $("#plus").attr("disabled", true);
                    $("#plus").css("background-color", "#BCBCBC");
                    $("#plus").css("color", "#000000");
                } else {
                    if (primaryblog !== null) {
                        var primaryid = primaryblog.attr("id");
                        var disabledminus = true;
                        var disabledplus = true;
                        for (j = 0; j < yearlydata.length; j += 1) {
                            if (parseInt(yearlydata[j][0]) === parseInt(primaryid)) {
                                if (parseInt(yearlydata[j][1]) === year - 1) {
                                    disabledminus = false;
                                }
                                if (parseInt(yearlydata[j][1]) === year + 1) {
                                    disabledplus = false;
                                }
                            }
                        }
                        $("#minus").attr("disabled", disabledminus);
                        if (disabledminus === true) {
                            $("#minus").css("background-color", "#BCBCBC");
                            $("#minus").css("color", "#000000");
                        } else {
                            $("#minus").css("background-color", "#FFFFFF");
                        }
                        $("#plus").attr("disabled", disabledplus);
                        if (disabledplus === true) {
                            $("#plus").css("background-color", "#BCBCBC");
                            $("#plus").css("color", "#000000");
                        } else {
                            $("#plus").css("background-color", "#FFFFFF");
                        }
                    } else {
                        var disabledminus = true;
                        var disabledplus = true;
                        if (year < 2017) {
                            disabledplus = false;
                        }
                        if (year > 2003) {
                            disabledminus = false;
                        }
                        $("#minus").attr("disabled", disabledminus);
                        if (disabledminus === true) {
                            $("#minus").css("background-color", "#BCBCBC");
                            $("#minus").css("color", "#000000");
                        } else {
                            $("#minus").css("background-color", "#FFFFFF");
                        }
                        $("#plus").attr("disabled", disabledplus);
                        if (disabledplus === true) {
                            $("#plus").css("background-color", "#BCBCBC");
                            $("#plus").css("color", "#000000");
                        } else {
                            $("#plus").css("background-color", "#FFFFFF");
                        }
                    }
                }
                updateDisplay(true, true, true, true, false);
            }
            // Reacts to a change in the year being viewed via the "-" button
            function decrementyear() {
                $("#plus").attr("disabled", false);
                $("#plus").css("background-color", "#FFFFFF");
                $("#plus").css("color", "#000000");
                year = Number.parseInt(year);
                year = year - 1;
                singleyeardata = [];
                for (i = 0; i < yearlydata.length; i += 1) {
                    if (yearlydata[i][1] === year) {
                        var temparray = [];
                        temparray[0] = yearlydata[i][0];
                        for (var k = 2; k < 53; k += 1) {
                            temparray[k - 1] = yearlydata[i][k];
                        }
                        singleyeardata[parseInt(yearlydata[i][0])] = temparray;
                    }
                }
                $("#year").val(year);
                if (primaryblog !== null) {
                    var primaryid = primaryblog.attr("id");
                    var disabledminus = true;
                    for (j = 0; j < yearlydata.length; j += 1) {
                        if (parseInt(yearlydata[j][0]) === parseInt(primaryid)) {
                            if (parseInt(yearlydata[j][1]) === year - 1) {
                                disabledminus = false;
                            }
                        }
                    }
                    $("#minus").attr("disabled", disabledminus);
                    if (disabledminus === true) {
                        $("#minus").css("background-color", "#BCBCBC");
                        $("#minus").css("color", "#000000");
                    } else {
                        $("#minus").css("background-color", "#FFFFFF");
                    }
                } else {
                    var disabledminus = true;
                    if (year > 2003) {
                        disabledminus = false;
                    }
                    $("#minus").attr("disabled", disabledminus);
                    if (disabledminus === true) {
                        $("#minus").css("background-color", "#BCBCBC");
                        $("#minus").css("color", "#000000");
                    } else {
                        $("#minus").css("background-color", "#FFFFFF");
                    }
                }
                updateDisplay(true, true, true, true, false);
            }
            // Reacts to a change in the year being viewed via the "-" button
            function incrementyear() {
                $("#minus").attr("disabled", false);
                $("#minus").css("background-color", "#FFFFFF");
                $("#minus").css("color", "#000000");
                year = Number.parseInt(year);
                year = year + 1;
                singleyeardata = [];
                for (i = 0; i < yearlydata.length; i += 1) {
                    if (yearlydata[i][1] === year) {
                        var temparray = [];
                        temparray[0] = yearlydata[i][0];
                        for (var k = 2; k < 53; k += 1) {
                            temparray[k - 1] = yearlydata[i][k];
                        }
                        singleyeardata[parseInt(yearlydata[i][0])] = temparray;
                    }
                }
                $("#year").val(year);
                if (primaryblog !== null) {
                    var primaryid = primaryblog.attr("id");
                    var disabledplus = true;
                    for (j = 0; j < yearlydata.length; j += 1) {
                        if (parseInt(yearlydata[j][0]) === parseInt(primaryid)) {
                            if (parseInt(yearlydata[j][1]) === year + 1) {
                                disabledplus = false;
                            }
                        }
                    }
                    $("#plus").attr("disabled", disabledplus);
                    if (disabledplus === true) {
                        $("#plus").css("background-color", "#BCBCBC");
                        $("#plus").css("color", "#000000");
                    } else {
                        $("#plus").css("background-color", "#FFFFFF");
                    }
                } else {
                    var disabledplus = true;
                    if (year < 2017) {
                        disabledplus = false;
                    }
                    $("#plus").attr("disabled", disabledplus);
                    if (disabledplus === true) {
                        $("#plus").css("background-color", "#BCBCBC");
                        $("#plus").css("color", "#000000");
                    } else {
                        $("#plus").css("background-color", "#FFFFFF");
                    }
                }
                updateDisplay(true, true, true, true, false);
            }

            // RESPOND TO CHANGES IN REQUESTS

            // Massive function that re-generates parts of the display when necessary (called by functions in the section above)
            function updateDisplay(graph, paths, outlines, scores, blog) {
                var checkedBoxes = getCheckedBoxes("filter_button");
                // Updates the positions, radii, and opacities of the "blog circles"
                if (graph) {
                    var blogCircles = svgContainerC.selectAll(".blogCircle");
                    blogCircles
                            .transition()
                            .attr("fill-opacity", function () {
                                var otherid = $(this).attr("id");
                                if (primaryblog !== null) {
                                    var primaryid = primaryblog.attr("id");
                                    if (parseInt(primaryid) !== parseInt(otherid)) {
                                        if (year === " All ") {
                                            return 1;
                                        } else {
                                            if (singleyeardata[otherid]) {
                                                return 1;
                                            } else {
                                                return 0;
                                            }
                                        }
                                    } else {
                                        if (year === " All ") {
                                            return 1;
                                        } else {
                                            return 1;
                                        }
                                    }
                                } else {
                                    if (year === " All ") {
                                        return 1;
                                    } else {
                                        if (singleyeardata[otherid]) {
                                            return 1;
                                        } else {
                                            return 0;
                                        }
                                    }
                                }
                            })
                            .attr("cx", function () {
                                var otherid = $(this).attr("id");
                                var otherIndex = blogids.indexOf(parseInt(otherid));
                                if (primaryblog !== null) {
                                    var primaryid = primaryblog.attr("id");
                                    var primaryIndex = blogids.indexOf(parseInt(primaryid));
                                    if (parseInt(primaryid) !== parseInt(otherid)) {
                                        if (year === " All ") {
                                            var cosim = cosineSim(data[primaryIndex], data[otherIndex], checkedBoxes);
                                            var ang = slice * otherIndex;
                                            var newx = ((width / 2) + (bigradius * (1 - (cosim))) * Math.cos(ang));
                                            return newx;
                                        } else {
                                            if (singleyeardata[otherid]) {
                                                var cosim = cosineSim(singleyeardata[primaryid], singleyeardata[otherid], checkedBoxes);
                                                var ang = slice * otherIndex;
                                                var newx = ((width / 2) + (bigradius * (1 - (cosim))) * Math.cos(ang));
                                                return newx;
                                            } else {
                                                var ang = slice * otherIndex;
                                                var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                                return cx + pageradius * Math.cos(ang);
                                            }
                                        }
                                    } else {
                                        if (year === " All ") {
                                            return width / 2;
                                        } else {
                                            return width / 2;
                                        }
                                    }
                                } else {
                                    if (year === " All ") {
                                        var theta = slice * parseInt(otherIndex);
                                        var newx = (cx + bigradius * Math.cos(theta));
                                        return newx;
                                    } else {
                                        if (singleyeardata[otherid]) {
                                            var theta = slice * parseInt(otherIndex);
                                            var newx = (cx + bigradius * Math.cos(theta));
                                            return newx;
                                        } else {
                                            var ang = slice * otherIndex;
                                            var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                            return cx + pageradius * Math.cos(ang);
                                        }
                                    }
                                }
                            })
                            .attr("cy", function () {
                                var otherid = $(this).attr("id");
                                var otherIndex = blogids.indexOf(parseInt(otherid));
                                if (primaryblog !== null) {
                                    var primaryid = primaryblog.attr("id");
                                    var primaryIndex = blogids.indexOf(parseInt(primaryid));
                                    if (parseInt(primaryid) !== parseInt(otherid)) {
                                        if (year === " All ") {
                                            var cosim = cosineSim(data[primaryIndex], data[otherIndex], checkedBoxes);
                                            var ang = slice * otherIndex;
                                            var newy = ((height / 2) + (bigradius * (1 - (cosim))) * Math.sin(ang));
                                            return newy;
                                        } else {
                                            if (singleyeardata[otherid]) {
                                                var cosim = cosineSim(singleyeardata[primaryid], singleyeardata[otherid], checkedBoxes);
                                                var ang = slice * otherIndex;
                                                var newy = ((height / 2) + (bigradius * (1 - (cosim))) * Math.sin(ang));
                                                return newy;
                                            } else {
                                                var ang = slice * otherIndex;
                                                var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                                return cy + pageradius * Math.sin(ang);
                                            }
                                        }
                                    } else {
                                        if (year === " All ") {
                                            return height / 2;
                                        } else {
                                            return height / 2;
                                        }
                                    }
                                } else {
                                    if (year === " All ") {
                                        var theta = slice * parseInt(otherIndex);
                                        var newy = (cy + bigradius * Math.sin(theta));
                                        return newy;
                                    } else {
                                        if (singleyeardata[otherid]) {
                                            var theta = slice * parseInt(otherIndex);
                                            var newy = (cy + bigradius * Math.sin(theta));
                                            return newy;
                                        } else {
                                            var ang = slice * otherIndex;
                                            var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                            return cy + pageradius * Math.sin(ang);
                                        }
                                    }
                                }
                            })
                            .attr("r", function () {
                                var id = $(this).attr("id");
                                var index = blogids.indexOf(parseInt(id));
                                return findRadius(index, year);
                            })
                            .duration(1500);
                }
                // Updates the positions, radii, and opacities of the "path dots"
                if (paths) {
                    var pathdots = svgContainerA.selectAll(".pathDot");
                    pathdots
                            .transition()
                            .attr("fill-opacity", function () {
                                var dotid = $(this).attr("id");
                                var blogyear = "";
                                var blogid = "";
                                if (parseInt(dotid.length) === parseInt(5)) {
                                    blogid = dotid[0];
                                    for (j = 1; j < 5; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                } else {
                                    for (j = 0; j < 2; j += 1) {
                                        blogid += dotid[j];
                                    }
                                    for (j = 2; j < 6; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                }
                                if (primaryblog !== null) {
                                    var primaryid = $(primaryblog).attr("id");
                                    if (primaryid !== blogid) {
                                        if (year === " All ") {
                                            var existsa = false;
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                    if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                        existsa = true;
                                                    }
                                                }
                                            }
                                            if (existsa) {
                                                return 0.4;
                                            }
                                        } else {
                                            var existsb = false;
                                            if (singleyeardata[parseInt(blogid)]) {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                        if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                            existsb = true;
                                                        }
                                                    }
                                                }
                                                if (existsb) {
                                                    return 0.4;
                                                }
                                            }
                                        }
                                    }
                                }
                                return 0;
                            })
                            .attr("cx", function () {
                                var dotid = $(this).attr("id");
                                var blogyear = "";
                                var blogid = "";
                                if (parseInt(dotid.length) === parseInt(5)) {
                                    blogid = dotid[0];
                                    for (j = 1; j < 5; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                } else {
                                    for (j = 0; j < 2; j += 1) {
                                        blogid += dotid[j];
                                    }
                                    for (j = 2; j < 6; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                }
                                var blogIndex = blogids.indexOf(parseInt(blogid));
                                if (primaryblog !== null) {
                                    var primaryid = $(primaryblog).attr("id");
                                    var primaryIndex = blogids.indexOf(parseInt(primaryID));
                                    if (primaryid !== blogid) {
                                        if (year === " All ") {
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                    if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                        var primarydata = [];
                                                        primarydata[0] = yearlydata[i][0];
                                                        for (var k = 2; k < 53; k += 1) {
                                                            primarydata[k - 1] = yearlydata[i][k];
                                                        }
                                                    }
                                                }
                                            }
                                            if (primarydata) {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newx = ((width / 2) + (bigradius * (1 - (cosim))) * Math.cos(ang));
                                                return newx;
                                            } else {
                                                var ang = slice * blogIndex;
                                                var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                                return cx + pageradius * Math.cos(ang);
                                            }
                                        } else {
                                            var exists = false;
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        exists = true;
                                                    }
                                                }
                                            }
                                            if (!exists) {
                                                var ang = slice * i;
                                                return cx + bigradius * Math.cos(angle);
                                            } else {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    } else if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var primarydata = [];
                                                            primarydata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                primarydata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newx = ((width / 2) + (bigradius * (1 - (cosim))) * Math.cos(ang));
                                                return newx;
                                            }
                                        }
                                    } else {
                                        return width / 2;
                                    }
                                } else {
                                    if (year === " All ") {
                                        var theta = slice * parseInt(blogIndex);
                                        var newx = (cx + bigradius * Math.cos(theta));
                                        return newx;
                                    } else {
                                        if (singleyeardata[parseInt(blogid)]) {
                                            var theta = slice * parseInt(blogIndex);
                                            var newx = (cx + bigradius * Math.cos(theta));
                                            return newx;
                                        } else {
                                            var ang = slice * blogIndex;
                                            var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                            return cx + pageradius * Math.cos(ang);
                                        }
                                    }
                                }
                            })
                            .attr("cy", function () {
                                var dotid = $(this).attr("id");
                                var blogyear = "";
                                var blogid = "";
                                if (parseInt(dotid.length) === parseInt(5)) {
                                    blogid = dotid[0];
                                    for (j = 1; j < 5; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                } else {
                                    for (j = 0; j < 2; j += 1) {
                                        blogid += dotid[j];
                                    }
                                    for (j = 2; j < 6; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                }
                                var blogIndex = blogids.indexOf(parseInt(blogid));
                                if (primaryblog !== null) {
                                    var primaryid = $(primaryblog).attr("id");
                                    var primaryIndex = blogids.indexOf(parseInt(primaryID));
                                    if (primaryid !== blogid) {
                                        if (year === " All ") {
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                    if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                        var primarydata = [];
                                                        primarydata[0] = yearlydata[i][0];
                                                        for (var k = 2; k < 53; k += 1) {
                                                            primarydata[k - 1] = yearlydata[i][k];
                                                        }
                                                    }
                                                }
                                            }
                                            if (primarydata) {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newy = ((height / 2) + (bigradius * (1 - (cosim))) * Math.sin(ang));
                                                return newy;
                                            } else {
                                                var ang = slice * blogIndex;
                                                var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                                return cy + pageradius * Math.sin(ang);
                                            }
                                        } else {
                                            var exists = false;
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        exists = true;
                                                    }
                                                }
                                            }
                                            if (!exists) {
                                                var ang = slice * i;
                                                return cy + bigradius * Math.sin(angle);
                                            } else {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    } else if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var primarydata = [];
                                                            primarydata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                primarydata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newy = ((height / 2) + (bigradius * (1 - (cosim))) * Math.sin(ang));
                                                return newy;
                                            }
                                        }
                                    } else {
                                        return height / 2;
                                    }
                                } else {
                                    if (year === " All ") {
                                        var theta = slice * parseInt(blogIndex);
                                        var newy = (cy + bigradius * Math.sin(theta));
                                        return newy;
                                    } else {
                                        if (singleyeardata[parseInt(blogid)]) {
                                            var theta = slice * parseInt(blogIndex);
                                            var newy = (cy + bigradius * Math.sin(theta));
                                            return newy;
                                        } else {
                                            var ang = slice * blogIndex;
                                            var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                            return cy + pageradius * Math.sin(ang);
                                        }
                                    }
                                }
                            })
                            .attr("r", function () {
                                var dotid = $(this).attr("id");
                                var blogyear = "";
                                var blogid = "";
                                if (parseInt(dotid.length) === parseInt(5)) {
                                    blogid = dotid[0];
                                    for (j = 1; j < 5; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                } else {
                                    for (j = 0; j < 2; j += 1) {
                                        blogid += dotid[j];
                                    }
                                    for (j = 2; j < 6; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                }
                                var blogindex = blogids.indexOf(parseInt(blogid));
                                return findRadius(blogindex, blogyear);
                            })
                            .duration(1500);
                }
                // Updates the positions, radii, and outlines of the secondary "path dots" (created only for outlining purposes)
                // Also outlines the "blog circles" when necessary
                if (outlines) {
                    var pathdotsB = svgContainerB.selectAll(".pathDotB");
                    pathdotsB
                            .transition()
                            .attr("cx", function () {
                                var dotid = $(this).attr("id");
                                var blogyear = "";
                                var blogid = "";
                                if (parseInt(dotid.length) === parseInt(6)) {
                                    blogid = dotid[0];
                                    for (j = 1; j < 5; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                } else {
                                    for (j = 0; j < 2; j += 1) {
                                        blogid += dotid[j];
                                    }
                                    for (j = 2; j < 6; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                }
                                var blogIndex = blogids.indexOf(parseInt(blogid));
                                if (primaryblog !== null) {
                                    var primaryid = $(primaryblog).attr("id");
                                    var primaryIndex = blogids.indexOf(parseInt(primaryID));
                                    if (primaryid !== blogid) {
                                        if (year === " All ") {
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                    if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                        var primarydata = [];
                                                        primarydata[0] = yearlydata[i][0];
                                                        for (var k = 2; k < 53; k += 1) {
                                                            primarydata[k - 1] = yearlydata[i][k];
                                                        }
                                                    }
                                                }
                                            }
                                            if (primarydata) {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newx = ((width / 2) + (bigradius * (1 - (cosim))) * Math.cos(ang));
                                                return newx;
                                            } else {
                                                var ang = slice * blogIndex;
                                                var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                                return cx + pageradius * Math.cos(ang);
                                            }
                                        } else {
                                            var exists = false;
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        exists = true;
                                                    }
                                                }
                                            }
                                            if (!exists) {
                                                var ang = slice * i;
                                                return cx + bigradius * Math.cos(angle);
                                            } else {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    } else if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var primarydata = [];
                                                            primarydata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                primarydata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newx = ((width / 2) + (bigradius * (1 - (cosim))) * Math.cos(ang));
                                                return newx;
                                            }
                                        }
                                    } else {
                                        return width / 2;
                                    }
                                } else {
                                    if (year === " All ") {
                                        var theta = slice * parseInt(blogIndex);
                                        var newx = (cx + bigradius * Math.cos(theta));
                                        return newx;
                                    } else {
                                        if (singleyeardata[parseInt(blogid)]) {
                                            var theta = slice * parseInt(blogIndex);
                                            var newx = (cx + bigradius * Math.cos(theta));
                                            return newx;
                                        } else {
                                            var ang = slice * blogIndex;
                                            var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                            return cx + pageradius * Math.cos(ang);
                                        }
                                    }
                                }
                            })
                            .attr("cy", function () {
                                var dotid = $(this).attr("id");
                                var blogyear = "";
                                var blogid = "";
                                if (parseInt(dotid.length) === parseInt(6)) {
                                    blogid = dotid[0];
                                    for (j = 1; j < 5; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                } else {
                                    for (j = 0; j < 2; j += 1) {
                                        blogid += dotid[j];
                                    }
                                    for (j = 2; j < 6; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                }
                                var blogIndex = blogids.indexOf(parseInt(blogid));
                                if (primaryblog !== null) {
                                    var primaryid = $(primaryblog).attr("id");
                                    var primaryIndex = blogids.indexOf(parseInt(primaryID));
                                    if (primaryid !== blogid) {
                                        if (year === " All ") {
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                    if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                        var primarydata = [];
                                                        primarydata[0] = yearlydata[i][0];
                                                        for (var k = 2; k < 53; k += 1) {
                                                            primarydata[k - 1] = yearlydata[i][k];
                                                        }
                                                    }
                                                }
                                            }
                                            if (primarydata) {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newy = ((height / 2) + (bigradius * (1 - (cosim))) * Math.sin(ang));
                                                return newy;
                                            } else {
                                                var ang = slice * blogIndex;
                                                var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                                return cy + pageradius * Math.sin(ang);
                                            }
                                        } else {
                                            var exists = false;
                                            for (var i = 0; i < yearlydata.length; i += 1) {
                                                if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        exists = true;
                                                    }
                                                }
                                            }
                                            if (!exists) {
                                                var ang = slice * i;
                                                return cy + bigradius * Math.sin(angle);
                                            } else {
                                                for (var i = 0; i < yearlydata.length; i += 1) {
                                                    if (parseInt(yearlydata[i][0]) === parseInt(blogid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var otherdata = [];
                                                            otherdata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                otherdata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    } else if (parseInt(yearlydata[i][0]) === parseInt(primaryid)) {
                                                        if (parseInt(yearlydata[i][1]) === parseInt(blogyear)) {
                                                            var primarydata = [];
                                                            primarydata[0] = yearlydata[i][0];
                                                            for (var k = 2; k < 53; k += 1) {
                                                                primarydata[k - 1] = yearlydata[i][k];
                                                            }
                                                        }
                                                    }
                                                }
                                                var cosim = cosineSim(primarydata, otherdata, checkedBoxes);
                                                var ang = slice * blogIndex;
                                                var newy = ((height / 2) + (bigradius * (1 - (cosim))) * Math.sin(ang));
                                                return newy;
                                            }
                                        }
                                    } else {
                                        return height / 2;
                                    }
                                } else {
                                    if (year === " All ") {
                                        var theta = slice * parseInt(blogIndex);
                                        var newy = (cy + bigradius * Math.sin(theta));
                                        return newy;
                                    } else {
                                        if (singleyeardata[parseInt(blogid)]) {
                                            var theta = slice * parseInt(blogIndex);
                                            var newy = (cy + bigradius * Math.sin(theta));
                                            return newy;
                                        } else {
                                            var ang = slice * blogIndex;
                                            var pageradius = Math.pow(Math.pow(height, 2) + Math.pow(width, 2), 0.5) / 2;
                                            return cy + pageradius * Math.sin(ang);
                                        }
                                    }
                                }
                            })
                            .attr("r", function () {
                                var dotid = $(this).attr("id");
                                var blogyear = "";
                                var blogid = "";
                                if (parseInt(dotid.length) === parseInt(6)) {
                                    blogid = dotid[0];
                                    for (j = 1; j < 5; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                } else {
                                    for (j = 0; j < 2; j += 1) {
                                        blogid += dotid[j];
                                    }
                                    for (j = 2; j < 6; j += 1) {
                                        blogyear += dotid[j];
                                    }
                                }
                                var blogindex = blogids.indexOf(parseInt(blogid));
                                return findRadius(blogindex, blogyear);
                            })
                            .attr("stroke", function () {
                                if (secondaryblog !== null) {
                                    var secondaryid = $(secondaryblog).attr("id");
                                    var dotid = $(this).attr("id");
                                    var blogid = "";
                                    if (parseInt(dotid.length) === parseInt(6)) {
                                        blogid = dotid[0];
                                    } else {
                                        for (j = 0; j < 2; j += 1) {
                                            blogid += dotid[j];
                                        }
                                    }
                                    if (parseInt(secondaryid) === parseInt(blogid)) {
                                        return "#000000";
                                    }
                                }
                                return "none";
                            })
                            .attr("stroke-width", function () {
                                if (secondaryblog !== null) {
                                    var secondaryid = $(secondaryblog).attr("id");
                                    var dotid = $(this).attr("id");
                                    var blogid = "";
                                    if (parseInt(dotid.length) === parseInt(6)) {
                                        blogid = dotid[0];
                                    } else {
                                        for (j = 0; j < 2; j += 1) {
                                            blogid += dotid[j];
                                        }
                                    }
                                    if (parseInt(secondaryid) === parseInt(blogid)) {
                                        return 3;
                                    }
                                }
                                return 0;
                            })
                            .attr("stroke-opacity", function () {
                                if (secondaryblog !== null) {
                                    var secondaryid = $(secondaryblog).attr("id");
                                    var dotid = $(this).attr("id");
                                    var blogid = "";
                                    if (parseInt(dotid.length) === parseInt(6)) {
                                        blogid = dotid[0];
                                    } else {
                                        for (j = 0; j < 2; j += 1) {
                                            blogid += dotid[j];
                                        }
                                    }
                                    if (parseInt(secondaryid) === parseInt(blogid)) {
                                        return 1;
                                    }
                                }
                                return 0;
                            })
                            .duration(1500);
                    var blogCircles = document.getElementsByClassName("blogCircle");
                    $(blogCircles)
                        .attr("stroke", function () {
                            if (secondaryblog !== null) {
                                var secondaryid = $(secondaryblog).attr("id");
                                var blogid = $(this).attr("id");
                                if (parseInt(secondaryid) === parseInt(blogid)) {
                                   return "#000000";
                                }
                            }
                            return "none";
                        })
                        .attr("stroke-width", function () {
                            if (secondaryblog !== null) {
                                var secondaryid = $(secondaryblog).attr("id");
                                var blogid = $(this).attr("id");
                                if (parseInt(secondaryid) === parseInt(blogid)) {
                                   return 3;
                                }
                            }
                            return 0;
                        })
                        .attr("stroke-opacity", function () {
                            if (secondaryblog !== null) {
                                var secondaryid = $(secondaryblog).attr("id");
                                var blogid = $(this).attr("id");
                                if (parseInt(secondaryid) === parseInt(blogid)) {
                                   return 1;
                                }
                            }
                            return 0;
                        })
                }
                // Removes Sim Scores currently being displayed and manipulates data to be sent to the "displaySimScores" method when necessary
                if (scores) {
                    $("#simScores").empty();
                    $("#simScoresTitle").empty();
                    $("#simScores").css("border-style", "none");
                    if (secondaryblog !== null) {
                        if (year === " All ") {
                            var secondaryid = secondaryblog.attr("id");
                            var secondaryIndex = blogids.indexOf(parseInt(secondaryid));
                            var selectedTopics = getCheckedBoxes("filter_button");
                            var primaryID = primaryblog.attr("id");
                            var primaryIndex = blogids.indexOf(parseInt(primaryID));
                            // look up average topic scores for this blog and for the center blog
                            var secondaryTopics = data[secondaryIndex];
                            var primaryTopcis = data[primaryIndex];
                            // Determine the RGB components of the clicked blog
                            var rgb = secondaryblog.css("fill");
                            // calculate like a dot product, but put into a vector rather than adding
                            var dotVector = Array(selectedTopics.length);
                            for (var i = 0; i < secondaryTopics.length; i++) {
                                if (parseInt(selectedTopics.indexOf(i)) !== parseInt(-1)) {
                                    dotVector[i] = secondaryTopics[i] * primaryTopcis[i];
                                }
                            }
                            // match dot-like vector with topics to sort
                            var topicSimScores = dotVector.map(function (e, i) {
                                return [e, topics[i]];
                            });
                            // now sort the topics
                            var sortedTopics = topicSimScores.sort(function (a, b) {
                                return b[0] - a[0];
                            });
                            var link = blogs[secondaryblog.attr("id") - 1];
                            $("#simScores").empty();
                            $("#simScoresTitle").empty();
                            $("#simScores").css("border-style", "none");
                            displaySimScores(sortedTopics, link, rgb);
                        } else {
                            var secondaryid = secondaryblog.attr("id");
                            var secondaryIndex = blogids.indexOf(parseInt(secondaryid));
                            var selectedTopics = getCheckedBoxes("filter_button");
                            var primaryID = primaryblog.attr("id");
                            var primaryIndex = blogids.indexOf(parseInt(primaryID));
                            // Determine the RGB components of the clicked blog
                            var rgb = secondaryblog.css("fill");
                            // look up average topic scores for this blog and for the center blog
                            var secondaryTopics = singleyeardata[secondaryid];
                            var primaryTopcis = singleyeardata[primaryID];
                            if (secondaryTopics) {
                                // calculate like a dot product, but put into a vector rather than adding
                                var dotVector = Array(selectedTopics.length);
                                for (var i = 1; i < secondaryTopics.length - 1; i++) {
                                    if (parseInt(selectedTopics.indexOf(i)) !== parseInt(-1)) {
                                        dotVector[i] = secondaryTopics[i] * primaryTopcis[i];
                                    }
                                }
                                // match dot-like vector with topics to sort
                                var topicSimScores = dotVector.map(function (e, i) {
                                    return [e, topics[i]];
                                });
                                // now sort the topics
                                var sortedTopics = topicSimScores.sort(function (a, b) {
                                    return b[0] - a[0];
                                });
                                var link = blogs[secondaryblog.attr("id") - 1];
                                $("#simScores").empty();
                                $("#simScoresTitle").empty();
                                $("#simScores").css("border-style", "none");
                                displaySimScores(sortedTopics, link, rgb);
                            } else {
                                $("#simScores").empty();
                                $("#simScoresTitle").empty();
                                $("#simScores").css("border-style", "none");
                            }
                        }
                    }
                }
                // Displays the name of the "primary blog" when applicable
                if (blog) {
                    $("#selected").empty();
                    if (primaryblog !== null) {
                        var link = blogs[primaryblog.attr("id") - 1];
                        var selectedlink = $("#selected");
                        selectedlink.html("Selected Blog: " + link);
                        selectedlink.css("font-weight", "bold");
                        selectedlink.css("font-size", "20px");
                        secondaryblog = null;
                    }
                }
            }
        </script>
    </body>
</html>
